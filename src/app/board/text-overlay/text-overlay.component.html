<main
  fxLayout="column"
  fxLayoutAlign="center center"
  *ngIf="{
    isGameStarting: isGameStarting$ | async,
    startStage: startStage$ | async,
    hasTileActive: hasTileActive$ | async,
    isPlayerWaiting: isPlayerWaiting$ | async,
    isActivePlayerPlaying: isActivePlayerPlaying$ | async
  } as observables"
>
  <!------------ GAME START -------------->
  <article
    *ngIf="
      observables.startStage === 'tileChoice' && !observables.isPlayerWaiting
    "
    class="top banner text-box"
  >
    <h2>Sélectionnez votre case <br />de départ</h2>
  </article>
  <article
    *ngIf="
      observables.hasTileActive &&
      observables.startStage === 'tileChoice' &&
      !observables.isPlayerWaiting
    "
    class="top banner text-box"
  >
    <h2>Choisir cette case ?</h2>
    <button
      mat-icon-button
      class="validation-buttons"
      id="validate"
      (click)="validateStartTile()"
    >
      <mat-icon svgIcon="validate"></mat-icon>
    </button>
    <button
      mat-icon-button
      class="validation-buttons"
      id="cancel"
      (click)="cancelStartTileChoice()"
    >
      <mat-icon svgIcon="close-blur"></mat-icon>
    </button>
  </article>
  <!------------ MULTI STEP ACTIONS -------------->
  <article
    *ngIf="isActionActive$('migration') | async"
    class="top banner text-box"
  >
    <h2>Choisissez une case <br />vers laquelle migrer</h2>
  </article>
  <article
    *ngIf="isActionActive$('proliferation') | async"
    class="top banner text-box"
  >
    <h2>Choisissez une case <br />sur laquelle proliférer</h2>
  </article>
  <article
    *ngIf="isActionActive$('assimilation') | async"
    class="top banner text-box"
  >
    <h2>Choisissez une case <br />à assimiler</h2>
  </article>
  <article
    *ngIf="isActionActive$('rallying') | async"
    class="top banner text-box"
  >
    <h2>Choisissez une case <br />à rallier</h2>
  </article>
  <!------------ OTHER PLAYER PLAYING -------------->
  <article
    *ngIf="!observables.isActivePlayerPlaying && !observables.isGameStarting"
    class="top banner text-box"
  >
    <h2>Au tour <br />du joueur adverse...</h2>
  </article>
</main>

<!------------ VISUAL OVERLAYS -------------->
<!------------ GAME START: WAITING OPPONENT ABILITY CHOICE -------------->
<article
  fxFlexFill
  *ngIf="
    (isGameStarting$ | async) &&
    (startStage$ | async) === 'abilityChoice' &&
    (isPlayerWaiting$ | async)
  "
  class="visual-overlay"
>
  <section fxFlexFill class="opacity"></section>
  <main
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="start center"
    class="absolute"
  >
    <section fxFlex="10"></section>
    <section
      fxFlex="30"
      class="species relative"
      style="
      --primary-color: {{ getActivePlayerColors().primary }};
      --secondary-color: {{ getActivePlayerColors().secondary }}"
    >
      <mat-icon fxFlexFill svgIcon="hex"></mat-icon>
      <mat-icon
        class="species-icon"
        id="species-title"
        [svgIcon]="(activeSpecies$ | async).abilities[0].id"
      ></mat-icon>
    </section>
    <section fxFlex="5"></section>
    <section fxFlex="17.5">
      <mat-icon fxFlexFill svgIcon="hourglass"></mat-icon>
    </section>
    <section class="banner text-box">
      <h2>En attente de l'adversaire...</h2>
    </section>
  </main>
</article>

<!------------ GAME START: ABILITY CHOICES MADE -------------->
<article
  fxFlexFill
  *ngIf="(isGameStarting$ | async) && (startStage$ | async) === 'tileChoice'"
  class="fade-in-out visual-overlay"
  style="--animation-duration: 0.25s; --animation-delay: 0.5s"
>
  <section fxFlexFill class="full-opacity"></section>
  <main
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="start center"
    class="absolute"
  >
    <section fxFlex="10"></section>
    <section
      fxFlex="30"
      class="species relative"
      style="
      --primary-color: {{ getActivePlayerColors().primary }};
      --secondary-color: {{ getActivePlayerColors().secondary }}"
    >
      <mat-icon fxFlexFill svgIcon="hex"></mat-icon>
      <mat-icon
        class="species-icon"
        id="species-title"
        [svgIcon]="(activeSpecies$ | async).abilities[0].id"
      ></mat-icon>
    </section>
    <section class="banner text-box">
      <h2>C'est parti !</h2>
    </section>
    <section
      fxFlex="30"
      class="species relative"
      style="
        --primary-color: {{ getOpponentColors().primary }};
        --secondary-color: {{ getOpponentColors().secondary }}"
    >
      <mat-icon fxFlexFill svgIcon="hex"></mat-icon>
      <mat-icon
        class="species-icon"
        id="species-title"
        [svgIcon]="getOpponentSpecies().abilities[0].id"
      ></mat-icon>
    </section>
  </main>
</article>

<!------------ GAME START: WAITING OPPONENT TILE CHOICE -------------->
<article
  fxFlexFill
  *ngIf="
    (isGameStarting$ | async) &&
    (startStage$ | async) === 'tileChoice' &&
    (isPlayerWaiting$ | async)
  "
  class="visual-overlay"
>
  <section fxFlexFill class="low-opacity"></section>
  <main
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="start center"
    class="absolute"
  >
    <section fxFlex="39"></section>
    <section fxFlex="17.5">
      <mat-icon fxFlexFill svgIcon="hourglass"></mat-icon>
    </section>
    <section class="banner text-box">
      <h2>En attente de l'adversaire...</h2>
    </section>
  </main>
</article>

<!------------ UP TO YOU ! -------------->
<article
  fxFlexFill
  *ngIf="!(isGameStarting$ | async) && isActivePlayerPlaying$ | async"
  class="fade-in-out visual-overlay"
  style="--animation-duration: 0s; --animation-delay: 0s"
>
  <section fxFlexFill class="opacity"></section>
  <section
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="center center"
    class="absolute"
  >
    <section
      class="species relative"
      style="
      --primary-color: {{ getActivePlayerColors().primary }};
      --secondary-color: {{ getActivePlayerColors().secondary }}"
    >
      <mat-icon fxFlexFill svgIcon="hex"></mat-icon>
      <mat-icon
        class="species-icon"
        [svgIcon]="(activeSpecies$ | async).abilities[0].id"
      ></mat-icon>
    </section>
    <section class="banner text-box">
      <h2>C'est à vous !</h2>
    </section>
  </section>
</article>

<!------------ SCORE COUNT -------------->
<article
  fxFlexFill
  *ngIf="isGameFinished$ | async"
  class="visual-overlay"
  fxLayout="column"
  fxLayoutAlign="start center"
>
  <aside fxFlex="2" fxFlexFill></aside>
  <header
    fxFlex="16"
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="center center"
  >
    <article>
      <mat-icon
        svgIcon="anima-empty"
        fxFlexAlign="start"
        class="anima-empty relative"
        fxLayoutAlign="center center"
      >
        <span
          *ngFor="let region of regions"
          class="absolute green increase-fade-in"
          style="
            --counter-from: {{
            regionScoresAnimationVariables.playerVariables[
              'Qfle6AdrJZNkluwXzLiR7YgeUBH2'
            ][region.name].from
          }};
            --counter-to: {{
            regionScoresAnimationVariables.playerVariables[
              'Qfle6AdrJZNkluwXzLiR7YgeUBH2'
            ][region.name].to
          }};
            --animation-duration: {{
            regionScoresAnimationVariables.subTotalDuration
          }}s;
            --animation-delay: {{
            regionScoresAnimationVariables.playerVariables[
              'Qfle6AdrJZNkluwXzLiR7YgeUBH2'
            ][region.name].delay
          }}s;
            --fade-out-delay: {{
            regionScoresAnimationVariables.subTotalDuration +
              regionScoresAnimationVariables.playerVariables[
                'Qfle6AdrJZNkluwXzLiR7YgeUBH2'
              ][region.name].delay +
              0.002
          }}s;
          "
        ></span>
      </mat-icon>
    </article>
  </header>

  <aside class="relative" fxFlex="63" fxFlexFill>
    <!--

      <section
      class="region absolute"
      id="{{ region.name }}"
      *ngFor="let region of regions"
    >
      <article
        *ngFor="let score of fakePlayerArray; let i = index"
        class="absolute"
        [ngClass]="{
          'bigger-up': i === 0,
          'bigger-down': i === 1
        }"
        style="
          --animation-duration: {{
          regionScoresAnimationVariables.regionDuration
        }}s;
          --animation-delay: {{
          regionScoresAnimationVariables[region.name + i].delay
        }}s;
        "
      >
        <h2 id="region-score">+{{ players[i].regionScores[region.name] }}</h2>
      </article>
    </section> -->
  </aside>
  <footer
    fxFlex="16"
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="center center"
  >
    <article>
      <mat-icon
        svgIcon="anima-empty"
        fxFlexAlign="start"
        class="anima-empty relative"
        fxLayoutAlign="center center"
      >
        <span
          class="pop-in absolute red"
          style="--animation-duration: {{
            victoryAnimationVariables.player2Score.duration
          }}s; --animation-delay: {{
            victoryAnimationVariables.player2Score.delay
          }}s"
          >+21</span
        >
      </mat-icon>
    </article>
  </footer>
  <aside fxFlex="2" fxFlexFill></aside>
  <aside fxFlexFill fxFlex="1" class="orange"></aside>
</article>
<!------------ VICTORY 1/2 -------------->
<!-- <article fxFlexFill *ngIf="isGameFinished$ | async" class="visual-overlay">
  <section fxFlexFill class="medium-opacity"></section>
  <main
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="start center"
    class="absolute"
  >
    <article
      fxFlexFill
      fxFlex="40"
      fxLayout="row"
      fxLayoutAlign="center center"
    >
      <h2 class="player-name green margin-aside">Nurgle</h2>
    </article>
    <article
      fxFlexFill
      fxFlex="19"
      fxLayout="row"
      fxLayoutAlign="center center"
    >
      <mat-icon
        svgIcon="anima-empty"
        fxFlexAlign="start"
        class="anima-empty relative"
        fxLayoutAlign="center center"
      >
        <span
          class="absolute green pop-in"
          style="--animation-duration: {{
            victoryAnimationVariables.player1Score.duration
          }}s; --animation-delay: {{ victoryAnimationVariables.player1Score.delay }}s"
          >+8</span
        >
      </mat-icon>
      <section
        class="orange-border pop-out"
        style=" --animation-duration: {{
          victoryAnimationVariables.firstScreenTransition.duration
        }}s; --animation-delay: {{
          victoryAnimationVariables.firstScreenTransition.delay
        }}s"
        fxFlexFill
        fxFlex="45"
        fxLayout="row"
        fxLayoutAlign="center center"
      >
        <h2
          class="score increase no-margin green"
          style="
            --counter-from: 48;
            --counter-to: 56;
            --animation-duration: {{
            victoryAnimationVariables.player1TotalScore.duration
          }}s; --animation-delay: {{
            victoryAnimationVariables.player1TotalScore.delay
          }}s
          "
        ></h2>
        <h3 class="no-margin" id="score-line">-</h3>
        <h2
          class="score increase no-margin red"
          style="
            --counter-from: 32;
            --counter-to: 53;
            --animation-duration: {{
            victoryAnimationVariables.player2TotalScore.duration
          }}s; --animation-delay: {{
            victoryAnimationVariables.player2TotalScore.delay
          }}s
          "
        ></h2>
      </section>
      <mat-icon
        svgIcon="anima-empty"
        fxFlexAlign="start"
        class="anima-empty relative"
        fxLayoutAlign="center center"
      >
        <span
          class="pop-in absolute red"
          style="--animation-duration: {{
            victoryAnimationVariables.player2Score.duration
          }}s; --animation-delay: {{ victoryAnimationVariables.player2Score.delay }}s"
          >+21</span
        >
      </mat-icon>
    </article>
    <article
      fxFlexFill
      fxFlex="40"
      fxLayout="row"
      fxLayoutAlign="center center"
    >
      <h2 class="player-name red margin-aside">Jelly0</h2>
    </article>
    <aside fxFlexFill fxFlex="1" class="orange"></aside>
  </main>
</article> -->

<!------------ VICTORY 2/2-------------->
<!-- <article fxFlexFill *ngIf="isGameFinished$ | async" class="visual-overlay">
  <section *ngIf="scoreToggle" fxFlexFill class="full-opacity"></section>
  <main
    *ngIf="scoreToggle; else map"
    fxFlexFill
    fxLayout="column"
    fxLayoutAlign="start center"
    class="absolute"
  >
    <article fxFlexFill fxFlex="10"></article>
    <article
      fxFlexFill
      fxFlex="10"
      class="center victory"
      [ngClass]="{
        'cling-slide-down': !victoryAnimationVariables.isAnimationDone
      }"
      style="
      --animation-duration: {{ victoryAnimationVariables.victoryTitle.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.victoryTitle.delay }}s"
    >
      <h1>VICTOIRE</h1>
    </article>
    <article
      fxFlexFill
      fxFlex="10"
      fxLayout="row"
      fxLayoutAlign="center center"
      [ngClass]="{
        'name-slide-down': !victoryAnimationVariables.isAnimationDone
      }"
      style="
      --animation-duration: {{ victoryAnimationVariables.winnerTitle.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.winnerTitle.delay }}s"
    >
      <mat-icon
        svgIcon="star"
        class="star rotate"
        style="--animation-delay: {{
          victoryAnimationVariables.isAnimationDone
            ? 0
            : victoryAnimationVariables.winnerStars.delay
        }}s"
      ></mat-icon>
      <h2 class="player-name green margin-aside">Nurgle</h2>
      <mat-icon
        svgIcon="star"
        class="star rotate"
        style="--animation-delay: {{
          victoryAnimationVariables.isAnimationDone
            ? 0
            : victoryAnimationVariables.winnerStars.delay
        }}s"
      ></mat-icon>
    </article>
    <article
      fxFlexFill
      fxFlex="20"
      fxLayoutAlign="center end"
      [ngClass]="{
        'fade-in': !victoryAnimationVariables.isAnimationDone
      }"
      style="
      --animation-duration: {{ victoryAnimationVariables.victoryDetails.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.victoryDetails.delay }}s"
    >
      <mat-icon
        svgIcon="anima-blur"
        class="anima relative"
        fxLayoutAlign="center center"
        ><span class="absolute victory-score">56</span></mat-icon
      >
    </article>
    <article
      class="playerSpecies"
      [ngClass]="{
        'fade-in': !victoryAnimationVariables.isAnimationDone
      }"
      fxFlexFill
      fxFlex="20"
      fxLayout="row"
      style="
      --animation-duration: {{ victoryAnimationVariables.victoryDetails.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.victoryDetails.delay }}s"
    >
      <div
        *ngFor="let species of winningPlayerSpecies$ | async"
        class="species relative small-margin-aside"
        id="winnerSpecies"
        style="
        --primary-color: {{ species.colors.primary }};
        --secondary-color: {{ species.colors.secondary }}"
      >
        <mat-icon fxFlexFill svgIcon="hex"></mat-icon>
        <mat-icon
          class="species-icon"
          id="species-title"
          [svgIcon]="species.abilities[0].id"
        ></mat-icon>
      </div>
    </article>
    <article
      fxFlexFill
      fxFlex="10"
      fxLayoutAlign="center end"
      [ngClass]="{
        'fade-in': !victoryAnimationVariables.isAnimationDone
      }"
      id="no-margin"
      style="
      --animation-duration: {{ victoryAnimationVariables.victoryDetails.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.victoryDetails.delay }}s"
    >
      <h2 class="player-name no-margin red">Jelly0</h2>
      <h3 class="no-margin" id="line">-</h3>
      <h2 class="player-name no-margin red">32</h2>
    </article>
    <aside fxFlexFill fxFlex="4"></aside>
    <footer
      fxFlexFill
      fxFlex="16"
      fxLayout="row"
      fxLayoutAlign="space-around center"
      [ngClass]="{
        'fade-in': !victoryAnimationVariables.isAnimationDone
      }"
      style="
      --animation-duration: {{ victoryAnimationVariables.victoryDetails.duration }}s;
      --animation-delay: {{ victoryAnimationVariables.victoryDetails.delay }}s"
    >
      <button class="nav-button" (click)="toggleScoreToggle()">
        <h2>Voir la carte</h2>
      </button>
      <button class="nav-button" (click)="leave()">
        <h2>Quitter</h2>
      </button>
    </footer>
    <aside fxFlexFill fxFlex="1" class="orange"></aside>
  </main>
  <ng-template #map>
    <main fxFlexFill fxLayout="column" fxLayoutAlign="space-around center">
      <header
        class="grey"
        fxFlexFill
        fxFlex="16"
        fxLayout="row"
        fxLayoutAlign="center center"
      >
        <mat-icon class="baby" svgIcon="baby"></mat-icon>
      </header>
      <aside class="click-through" fxFlexFill fxFlex="67"></aside>
      <footer
        fxFlexFill
        fxFlex="16"
        fxLayout="row"
        fxLayoutAlign="space-around center"
        class="grey"
      >
        <button class="nav-button" (click)="toggleScoreToggle()">
          <h2>Voir les scores</h2>
        </button>
        <button class="nav-button" (click)="leave()">
          <h2>Quitter</h2>
        </button>
      </footer>
      <aside fxFlexFill fxFlex="1" class="orange"></aside>
    </main>
  </ng-template>
</article> -->
