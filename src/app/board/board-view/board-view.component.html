<div class="main">
  <mat-card class="score absolute">
    <mat-card-header
      ><mat-card-title>Tableau des scores</mat-card-title></mat-card-header
    >
    <mat-card-content *ngIf="game$ | async as game">
      <h3>Partie</h3>
      <li>Ère: {{ game.eraCount }}</li>
      <li>Tours: {{ game.turnCount }}</li>
      <h3>Tour en cours</h3>
      <li>Joueur actif: {{ game.activePlayerId.slice(0, 4) }}</li>
      <li *ngIf="activeSpecies$ | async as species">
        Traits espèce active:
        <span *ngFor="let abilityId of species.abilityIds; let isLast = last"
          >{{ getAbilityFrName(abilityId) }}{{ isLast ? "" : ", " }}</span
        >
      </li>
      <li>Actions restantes: {{ game.remainingActions }}</li>
      <li>
        Colonisations possibles:
        <span *ngIf="(activeSpecies$ | async).abilityIds.includes('agility')">{{
          game.colonizationCount + getAbilityValue("agility")
        }}</span>
        <span
          *ngIf="!(activeSpecies$ | async).abilityIds.includes('agility')"
          >{{ game.colonizationCount }}</span
        >
      </li>
      <h3>Joueurs</h3>
      <li *ngFor="let player of players$ | async">
        {{ player.id.slice(0, 4) }}: {{ player.score }}
      </li>
    </mat-card-content>
  </mat-card>
  <div class="container">
    <div
      *ngFor="let tile of tiles$ | async; let i = index"
      [ngClass]="{
        blank: tile.type === 'blank',
        island: tile.type === 'island',
        mountains: tile.type === 'mountains',
        rockies: tile.type === 'rockies',
        plains: tile.type === 'plains',
        swamps: tile.type === 'swamps',
        forest: tile.type === 'forest',
        selected: isActive(tile.id),
        reachable: tile?.isReachable
      }"
      class="hex relative"
      (click)="play(i)"
    >
      <div fxFlexFill class="absolute grid" *ngIf="tile.species.length > 0">
        <div *ngFor="let species of tile.species" class="relative">
          <div
            fxFlexFill
            style="--img: url({{ getSpeciesImgUrl(species.id) }});"
            [ngClass]="{ species: tile.species.length > 0 }"
            *ngIf="species.quantity"
          >
            <div class="species-quantity absolute">
              {{ species.quantity }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="absolute" id="footer">
    <app-footer fxFlexFill></app-footer>
  </div>
</div>
