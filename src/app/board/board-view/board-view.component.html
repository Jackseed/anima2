<!------------ HEADER -------------->
<header>
  <app-header fxFlexFill></app-header>
</header>

<!------------ TEXT HEADER -------------->
<div
  fxLayout="column"
  fxLayoutAlign="center center"
  *ngIf="game$ | async as game"
>
  <!------------ GAME START -------------->
  <section *ngIf="game.startState === 'tileChoice'" class="start text-box">
    <h2>Sélectionnez votre case <br />de départ</h2>
  </section>
  <section *ngIf="game.startState === 'tileSelected'" class="start text-box">
    <h2>Choisir cette case ?</h2>
    <button
      mat-icon-button
      class="validation-buttons"
      id="validate"
      (click)="validateStartTile()"
    >
      <mat-icon svgIcon="validate"></mat-icon>
    </button>
    <button
      mat-icon-button
      class="validation-buttons"
      id="cancel"
      (click)="cancelStartTileChoice()"
    >
      <mat-icon svgIcon="close"></mat-icon>
    </button>
  </section>
  <!------------ MULTI STEP ACTIONS -------------->
  <section *ngIf="isActionActive$('migration') | async" class="start text-box">
    <h2>Choisissez une case <br />vers laquelle migrer</h2>
  </section>
  <section
    *ngIf="isActionActive$('proliferation') | async"
    class="start text-box"
  >
    <h2>Choisissez une case <br />sur laquelle proliférer</h2>
  </section>
  <section
    *ngIf="isActionActive$('assimilation') | async"
    class="start text-box"
  >
    <h2>Choisissez une case <br />à assimiler</h2>
  </section>
  <section
    *ngIf="isActionActive$('assimilation') | async"
    class="start text-box"
  >
    <h2>Choisissez une case <br />à rallier</h2>
  </section>
</div>

<pinch-zoom [double-tap]="false" disableZoomControl="disable">
  <main>
    <!------------ MAP -------------->
    <div class="no-font">
      <!------------ TILE -------------->
      <article
        *ngFor="let tile of tiles$ | async; let i = index"
        class="hex relative"
        [ngClass]="{
          blank: tile.type === 'blank',
          islands: tile.type === 'islands',
          mountains: tile.type === 'mountains',
          rockies: tile.type === 'rockies',
          plains: tile.type === 'plains',
          swamps: tile.type === 'swamps',
          forests: tile.type === 'forests',
          selected: isActive(tile.id),
          reachable: tile?.isReachable,
          attackable: tile?.isAttackable,
          proliferable: tile?.isProliferable,
          rallyable: tile?.isRallyable
        }"
        (click)="play(i)"
      >
        <!------------ INTERNAL TILE GRID FOR SPECIES -------------->
        <div
          fxFlexFill
          class="absolute"
          *ngIf="tile.species.length > 0"
          [ngClass]="{
            grid1: tile.species.length === 1,
            grid2: tile.species.length === 2,
            grid3: tile.species.length === 3,
            grid4: tile.species.length === 4,
            grid5: tile.species.length === 5,
            grid6: tile.species.length === 6,
            grid7: tile.species.length === 7
          }"
        >
          <!------------ SPECIES -------------->
          <div
            *ngFor="let species of tile.species; let i = index"
            class="tiles tile-container{{ i }}"
          >
            <div
              class="species tile{{ i }}"
              style="--img: url({{ getSpeciesImgUrl(species.id) }}); --color: {{
                species.color
              }}"
            >
              <mat-icon
                fxFlexFill
                [svgIcon]="species.mainAbilityId + '-ability'"
              ></mat-icon>
              <!--               <div class="species-quantity">
                {{ species.quantity }}
              </div> -->
            </div>
          </div>
        </div>
      </article>
    </div>
  </main>
</pinch-zoom>

<!------------ FOOTER -------------->
<footer
  *ngIf="hasActiveAbility$ | async"
  id="active-bar"
  style="--width-value: {{ 25 * (activeAbilityNumber$ | async) }}%"
>
  <app-active-bar></app-active-bar>
</footer>
<footer>
  <app-footer></app-footer>
</footer>
